/*
 * NStudioFrame2.java
 *
 * Created on 2008??10??15??, ????4:04
 */
package com.bca.utool.app;

import com.bca.pub.tools.Layouttool;
import com.bca.pub.tools.Nettool;
import com.bca.pub.tools.ProgressbarWindow;
import com.bca.pub.tools.Wftool;
import com.bca.studio.menu.I_DynBcaMenuBar;
import com.bca.studio.top.help.AboutBcaDialog;
import com.bca.utool.cwiz.UtCodeWizPForm;
import com.bca.utool.jtable.ui.HkBookJTableForm;
import java.awt.Dimension;
import java.awt.event.WindowEvent;
import java.util.HashMap;
import java.util.Map;
import javax.swing.JDialog;
import javax.swing.JMenu;

/**
 *
 * @author  BCA INC
 */
public class UToolFrame extends javax.swing.JFrame {

    final BcaUToolApp app;

    /** Creates new form NStudioFrame2 */
    public UToolFrame(final BcaUToolApp app) {
        this.app = app;
        initComponents();
        // wfinit();
        this.setDefaultCloseOperation(DO_NOTHING_ON_CLOSE);   //
    }

    @Override
    protected void processWindowEvent(WindowEvent e) {
        super.processWindowEvent(e);
        if (e.getID() == WindowEvent.WINDOW_CLOSING) {
            miExitActionPerformed(null);
        }
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        buttonGroup1 = new javax.swing.ButtonGroup();
        cardPanel = new javax.swing.JPanel();
        codeFactoryPanel = new javax.swing.JPanel();
        statusField = new javax.swing.JTextField();
        menuBar = new javax.swing.JMenuBar();
        menuFile = new javax.swing.JMenu();
        miExit = new javax.swing.JMenuItem();
        menuWin = new javax.swing.JMenu();
        miCodeFactory = new javax.swing.JRadioButtonMenuItem();
        miJTableMemo = new javax.swing.JMenuItem();
        jMenu1 = new javax.swing.JMenu();
        miHelpCenter = new javax.swing.JMenuItem();
        miAboutBCA = new javax.swing.JMenuItem();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        cardPanel.setLayout(new java.awt.CardLayout());

        codeFactoryPanel.setLayout(new java.awt.BorderLayout());
        cardPanel.add(codeFactoryPanel, "flowCanvasPanel");

        getContentPane().add(cardPanel, java.awt.BorderLayout.CENTER);

        statusField.setEditable(false);
        getContentPane().add(statusField, java.awt.BorderLayout.SOUTH);

        menuFile.setText("系统"); // NOI18N

        miExit.setText("退出"); // NOI18N
        miExit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                miExitActionPerformed(evt);
            }
        });
        menuFile.add(miExit);

        menuBar.add(menuFile);

        menuWin.setText("工作视图"); // NOI18N

        buttonGroup1.add(miCodeFactory);
        miCodeFactory.setSelected(true);
        miCodeFactory.setText("代码工厂"); // NOI18N
        miCodeFactory.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                miCodeFactoryActionPerformed(evt);
            }
        });
        menuWin.add(miCodeFactory);

        miJTableMemo.setText(org.openide.util.NbBundle.getMessage(UToolFrame.class, "UToolFrame.miJTableMemo.text")); // NOI18N
        miJTableMemo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                miJTableMemoActionPerformed(evt);
            }
        });
        menuWin.add(miJTableMemo);

        menuBar.add(menuWin);

        java.util.ResourceBundle bundle = java.util.ResourceBundle.getBundle("com/bca/utool/app/Bundle"); // NOI18N
        jMenu1.setText(bundle.getString("UToolFrame.jMenu1.text")); // NOI18N

        miHelpCenter.setText(bundle.getString("UToolFrame.miHelpCenter.text")); // NOI18N
        jMenu1.add(miHelpCenter);

        miAboutBCA.setText(bundle.getString("UToolFrame.miAboutBCA.text")); // NOI18N
        miAboutBCA.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                miAboutBCAActionPerformed(evt);
            }
        });
        jMenu1.add(miAboutBCA);

        menuBar.add(jMenu1);

        setJMenuBar(menuBar);

        pack();
    }// </editor-fold>//GEN-END:initComponents

private void miExitActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_miExitActionPerformed
    boolean b = Wftool.confirmDialog("退出提示", "真的退出BCA图形工具吗？");
    if (b) {
        BcaUToolApp.getApp().shutdownApp();
    }
}//GEN-LAST:event_miExitActionPerformed

private void miCodeFactoryActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_miCodeFactoryActionPerformed
    showCard("cwizCanvasPanel");
}//GEN-LAST:event_miCodeFactoryActionPerformed

private void miAboutBCAActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_miAboutBCAActionPerformed
    AboutBcaDialog dlg = new AboutBcaDialog(this, true);
    dlg.setBounds(app.getCenterBounds(dlg.getPreferredSize()));
    dlg.setVisible(true);
}//GEN-LAST:event_miAboutBCAActionPerformed

private void miJTableMemoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_miJTableMemoActionPerformed
    JDialog dlg = new JDialog(this, true);
    HkBookJTableForm f = new HkBookJTableForm();
//    AcdArithmeticJTableForm f = new AcdArithmeticJTableForm();
    dlg.setContentPane(f);
    Dimension dim = f.getPreferredSize();
    dim.width += 25;
    dlg.setBounds(Layouttool.getCenterBounds(dim));
    dlg.setVisible(true);
}//GEN-LAST:event_miJTableMemoActionPerformed

    public void setStatus(String s) {
        this.statusField.setText(s);
    }
    I_DynBcaMenuBar activeDMenuBar = null;

    public void showCard(String cardName) {
        java.awt.CardLayout l = (java.awt.CardLayout) cardPanel.getLayout();
        l.show(cardPanel, cardName);

        if (activeDMenuBar != null) {
            for (JMenu m : activeDMenuBar.getDynMenus()) {
                menuBar.remove(m);
            }
        }

        I_DynBcaMenuBar dmenuBar = dynMenus.get(cardName);
        if (dmenuBar != null) {
            int i = 1;
            for (JMenu m : dmenuBar.getDynMenus()) {
                menuBar.add(m, i++);
            }
        }
        activeDMenuBar = dmenuBar;
    }
// End of variables declaration
    final Map<String, I_DynBcaMenuBar> dynMenus = new HashMap<String, I_DynBcaMenuBar>();

    public void wfinit(ProgressbarWindow bar) {
        Nettool.initSocketFactory();
        // Timetool.logSysTime(Toolfunc.getCurrentFunctionName());
        codeFactoryPanel.add(UtCodeWizPForm.getInst(), java.awt.BorderLayout.CENTER);
        showCard("cwizCanvasPanel");
        bar.incValue();


        bar.incValue();

    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JPanel cardPanel;
    private javax.swing.JPanel codeFactoryPanel;
    private javax.swing.JMenu jMenu1;
    private javax.swing.JMenuBar menuBar;
    private javax.swing.JMenu menuFile;
    private javax.swing.JMenu menuWin;
    private javax.swing.JMenuItem miAboutBCA;
    private javax.swing.JRadioButtonMenuItem miCodeFactory;
    private javax.swing.JMenuItem miExit;
    private javax.swing.JMenuItem miHelpCenter;
    private javax.swing.JMenuItem miJTableMemo;
    private javax.swing.JTextField statusField;
    // End of variables declaration//GEN-END:variables
}
