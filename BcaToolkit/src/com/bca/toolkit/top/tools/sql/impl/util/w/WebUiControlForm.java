/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package com.bca.toolkit.top.tools.sql.impl.util.w;

import com.bca.pub.tools.Wftool;
import com.bca.toolkit.top.tools.sql.impl.util.w.jt.UiMemMapJTableForm;
import com.bca.toolkit.top.tools.sql.impl.util.w.jt.WebUiTemplUnitJTableForm;
import java.awt.CardLayout;
import javax.swing.DefaultComboBoxModel;

/**
 *
 * @author admin
 */
public class WebUiControlForm extends javax.swing.JPanel {

    final DefaultComboBoxModel model;
    private WebUiMemBean uiBean;
    final UiMemMapJTableForm mapjtForm;  //  = new UiMemMapJTableForm();
    final WebUiTemplUnitJTableForm hkTemplateForm;
    private WebUiMemForm webUiMemForm;

    /**
     * Creates new form WebUiControlForm
     */
    public WebUiControlForm() {
        model = new DefaultComboBoxModel();
        initComponents();
        // 
        mapjtForm = new UiMemMapJTableForm();
        hkTemplateForm = new WebUiTemplUnitJTableForm(this);
        wfinit();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        buttonGroup1 = new javax.swing.ButtonGroup();
        jLabel1 = new javax.swing.JLabel();
        controlBox = new javax.swing.JComboBox( model );
        mapFormPanel = new javax.swing.JPanel();
        jtableParentPanel = new javax.swing.JPanel();
        sqlParentPanel = new javax.swing.JPanel();
        jLabel6 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        sqlTextField = new javax.swing.JTextPane();
        jLabel7 = new javax.swing.JLabel();
        hktemplateParentPanel = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        postFixField = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        styleNameField = new javax.swing.JTextField();
        saveButton = new javax.swing.JButton();
        jLabel5 = new javax.swing.JLabel();
        xpathField = new javax.swing.JTextField();
        mapbyStaticRadio = new javax.swing.JRadioButton();
        mapbySqlRadio = new javax.swing.JRadioButton();
        mapByHkTemplateRadio = new javax.swing.JRadioButton();

        jLabel1.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.jLabel1.text")); // NOI18N

        mapFormPanel.setLayout(new java.awt.CardLayout());

        jtableParentPanel.setLayout(new java.awt.BorderLayout());
        mapFormPanel.add(jtableParentPanel, "static");

        jLabel6.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.jLabel6.text")); // NOI18N

        jScrollPane1.setViewportView(sqlTextField);

        jLabel7.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.jLabel7.text")); // NOI18N

        javax.swing.GroupLayout sqlParentPanelLayout = new javax.swing.GroupLayout(sqlParentPanel);
        sqlParentPanel.setLayout(sqlParentPanelLayout);
        sqlParentPanelLayout.setHorizontalGroup(
            sqlParentPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(sqlParentPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(sqlParentPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1)
                    .addGroup(sqlParentPanelLayout.createSequentialGroup()
                        .addComponent(jLabel6)
                        .addGap(31, 31, 31)
                        .addComponent(jLabel7)
                        .addGap(0, 443, Short.MAX_VALUE)))
                .addContainerGap())
        );
        sqlParentPanelLayout.setVerticalGroup(
            sqlParentPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(sqlParentPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(sqlParentPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel6)
                    .addComponent(jLabel7))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 287, Short.MAX_VALUE)
                .addContainerGap())
        );

        mapFormPanel.add(sqlParentPanel, "sql");

        hktemplateParentPanel.setLayout(new java.awt.BorderLayout());
        mapFormPanel.add(hktemplateParentPanel, "hktemplate");

        jLabel2.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.jLabel2.text")); // NOI18N

        jLabel3.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.jLabel3.text")); // NOI18N

        postFixField.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.postFixField.text")); // NOI18N

        jLabel4.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.jLabel4.text")); // NOI18N

        styleNameField.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.styleNameField.text")); // NOI18N

        saveButton.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.saveButton.text")); // NOI18N
        saveButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveButtonActionPerformed(evt);
            }
        });

        jLabel5.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.jLabel5.text")); // NOI18N

        xpathField.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.xpathField.text")); // NOI18N

        buttonGroup1.add(mapbyStaticRadio);
        mapbyStaticRadio.setSelected(true);
        mapbyStaticRadio.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.mapbyStaticRadio.text")); // NOI18N
        mapbyStaticRadio.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                mapbyStaticRadioActionPerformed(evt);
            }
        });

        buttonGroup1.add(mapbySqlRadio);
        mapbySqlRadio.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.mapbySqlRadio.text")); // NOI18N
        mapbySqlRadio.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                mapbySqlRadioActionPerformed(evt);
            }
        });

        buttonGroup1.add(mapByHkTemplateRadio);
        mapByHkTemplateRadio.setText(org.openide.util.NbBundle.getMessage(WebUiControlForm.class, "WebUiControlForm.mapByHkTemplateRadio.text")); // NOI18N
        mapByHkTemplateRadio.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                mapByHkTemplateRadioActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel4)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(styleNameField)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(saveButton))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel2)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(mapbyStaticRadio)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(mapbySqlRadio)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(mapByHkTemplateRadio)
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addComponent(mapFormPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(controlBox, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel3)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(postFixField, javax.swing.GroupLayout.PREFERRED_SIZE, 157, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel5)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(xpathField)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(styleNameField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(saveButton))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(xpathField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(controlBox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel3)
                    .addComponent(postFixField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(mapbyStaticRadio)
                    .addComponent(mapbySqlRadio)
                    .addComponent(mapByHkTemplateRadio))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(mapFormPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void saveButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveButtonActionPerformed
        // 
        if ("<请输入风格名称>".equals(this.styleNameField.getText()) || "".equals(this.styleNameField.getText())) {
            Wftool.messageDialog(false, "请输入风格名称");
            return;
        }
        uiBean.setStyleName(this.styleNameField.getText());
        uiBean.setCtype((WebUi_ControlType) controlBox.getSelectedItem());
        uiBean.setVarPostfix(this.postFixField.getText());
        uiBean.setXpath(this.xpathField.getText());
        if (mapByHkTemplateRadio.isSelected()) {
            uiBean.setKvMapMode(WebUiMemBean.UiMemMapMode.MapByHkTemplate);
            uiBean.setEstyleTemplUnits(hkTemplateForm.getTableModel().estyleTemplUnits);
        } else if (mapbySqlRadio.isSelected()) {
            uiBean.setKvMapMode(WebUiMemBean.UiMemMapMode.MapBySql);
        } else {
            uiBean.setKvMapMode(WebUiMemBean.UiMemMapMode.MapByStatic);
        }
        uiBean.setSqlForKvMap(sqlTextField.getText());
        webUiMemForm.saveBean('s', uiBean, null);
        // 
    }//GEN-LAST:event_saveButtonActionPerformed

    private void mapbyStaticRadioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mapbyStaticRadioActionPerformed
        getMapCardLayout().show(this.mapFormPanel, "static");
    }//GEN-LAST:event_mapbyStaticRadioActionPerformed

    private void mapbySqlRadioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mapbySqlRadioActionPerformed
        getMapCardLayout().show(this.mapFormPanel, "sql");
    }//GEN-LAST:event_mapbySqlRadioActionPerformed

    private void mapByHkTemplateRadioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mapByHkTemplateRadioActionPerformed
        getMapCardLayout().show(this.mapFormPanel, "hktemplate");
    }//GEN-LAST:event_mapByHkTemplateRadioActionPerformed
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JComboBox controlBox;
    private javax.swing.JPanel hktemplateParentPanel;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JPanel jtableParentPanel;
    private javax.swing.JRadioButton mapByHkTemplateRadio;
    private javax.swing.JPanel mapFormPanel;
    private javax.swing.JRadioButton mapbySqlRadio;
    private javax.swing.JRadioButton mapbyStaticRadio;
    private javax.swing.JTextField postFixField;
    private javax.swing.JButton saveButton;
    private javax.swing.JPanel sqlParentPanel;
    private javax.swing.JTextPane sqlTextField;
    private javax.swing.JTextField styleNameField;
    private javax.swing.JTextField xpathField;
    // End of variables declaration//GEN-END:variables

    private void wfinit() {
        for (WebUi_ControlType t : WebUi_ControlType.values()) {
            model.addElement(t);
        }
        jtableParentPanel.add(mapjtForm, java.awt.BorderLayout.CENTER);
        this.hktemplateParentPanel.add(hkTemplateForm, java.awt.BorderLayout.CENTER);
        // 
        this.mapbySqlRadio.setVisible(false);   // 暂时不支持
    }

    public void loadUiBean(WebUiMemBean bean) {
        this.uiBean = bean;
        // 
        this.styleNameField.setText(bean.getStyleName());
        controlBox.setSelectedItem(bean.getCtype());
        mapjtForm.getTableModel().load(bean);
        this.sqlTextField.setText(bean.getSqlForKvMap());
        switch (bean.getKvMapMode()) {
            case MapByHkTemplate:
                mapByHkTemplateRadio.setSelected(true);
                mapByHkTemplateRadioActionPerformed(null);
                break;
            case MapByStatic:
                mapbyStaticRadio.setSelected(true);
                mapbyStaticRadioActionPerformed(null);
                break;
            case MapBySql:
                mapbySqlRadio.setSelected(true);
                mapbySqlRadioActionPerformed(null);
                break;
        }
        xpathField.setText(bean.getXpath());
        hkTemplateForm.getTableModel().load(bean.getEstyleTemplUnits());
    }

    /**
     * @return the uiBean
     */
    public WebUiMemBean getUiBean() {
        return uiBean;
    }

    void setWebUiMemForm(WebUiMemForm webUiMemForm) {
        this.webUiMemForm = webUiMemForm;
    }

    /**
     * @return the webUiMemForm
     */
    public WebUiMemForm getWebUiMemForm() {
        return webUiMemForm;
    }

    private java.awt.CardLayout getMapCardLayout() {
        return (CardLayout) this.mapFormPanel.getLayout();
    }

    public void savePool() {
        this.saveButtonActionPerformed(null);
    }
}
